diff -Nur -x '*.orig' -x '*.rej' smeserver-spamassassin-1.3.0/createlinks mezzanine_patched_smeserver-spamassassin-1.3.0/createlinks
--- smeserver-spamassassin-1.3.0/createlinks	2003-08-29 03:37:04.000000000 +1000
+++ mezzanine_patched_smeserver-spamassassin-1.3.0/createlinks	2005-11-04 02:45:42.751923881 +1100
@@ -1,41 +1,8 @@
 #!/usr/bin/perl -w
 
-sub safe_symlink {
-    my ($from, $to) = @_;
-    use File::Basename;
-    use File::Path;
-    mkpath(dirname($to));
-    unlink($to);
-    symlink($from, $to) or die "Can't create symlink from $from to $to: $!";
-}
-
-sub panel_link
-{
-    my ($function, $panel) = @_;
-
-    my $cgibin = "root/etc/e-smith/web/panels/$panel/cgi-bin";
-
-    safe_symlink("../../../functions/$function",
-            "$cgibin/$function")
-}
-
-sub event_link
-{
-    my ($action, $event, $level) = @_;
-
-    safe_symlink("../actions/${action}",
-        "root/etc/e-smith/events/${event}/S${level}${action}");
-}
-
-sub service_link_enhanced
-{
-    my ($service, $level, $rc) = @_;
-
-    $rc = 7 unless defined $rc;
-    $level =~ /[^\d]/ or $level = "S${level}";
-    safe_symlink("/etc/rc.d/init.d/e-smith-service",
-        "root/etc/rc.d/rc${rc}.d/${level}${service}");
-}
+use esmith::Build::CreateLinks qw(:all);
+use File::Basename;
+use File::Path;
 
 #--------------------------------------------------
 # functions for manager panel
@@ -44,9 +11,12 @@
 
 # panel_link("otheremail", $panel);
 
-foreach $event ( qw( spamassassin-update bootstrap-console-save email-update ) )
+templates2events( "/etc/mail/spamassassin/local.cf",
+    qw( bootstrap-console-save email-update ) );
+
+foreach $event ( qw( bootstrap-console-save email-update ) )
 {
-    event_link("spamassassin-update", $event, "65");
+    safe_symlink("restart", "root/etc/e-smith/events/$event/services2adjust/spamd");
 }
 
 safe_symlink("daemontools", "root/etc/rc.d/init.d/spamd");
@@ -54,3 +24,4 @@
 service_link_enhanced("spamd", "K60", "6");
 service_link_enhanced("spamd", "K60", "0");
 service_link_enhanced("spamd", "K60", "1");
+
diff -Nur -x '*.orig' -x '*.rej' smeserver-spamassassin-1.3.0/root/etc/e-smith/events/actions/spamassassin-update mezzanine_patched_smeserver-spamassassin-1.3.0/root/etc/e-smith/events/actions/spamassassin-update
--- smeserver-spamassassin-1.3.0/root/etc/e-smith/events/actions/spamassassin-update	2003-06-27 02:07:34.000000000 +1000
+++ mezzanine_patched_smeserver-spamassassin-1.3.0/root/etc/e-smith/events/actions/spamassassin-update	1970-01-01 10:00:00.000000000 +1000
@@ -1,27 +0,0 @@
-#!/bin/sh
-
-#===============================================================================
-# copyright (C) 2003 Greg Zartman
-# copyright (C) 1999-2003 Mitel Networks Corporation
-#
-# This program is free software; you can redistribute it and/or modify
-# it under the terms of the GNU General Public License as published by
-# the Free Software Foundation; either version 2 of the License, or
-# (at your option) any later version.
-#
-# This program is distributed in the hope that it will be useful,
-# but WITHOUT ANY WARRANTY; without even the implied warranty of
-# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-# GNU General Public License for more details.
-#
-# You should have received a copy of the GNU General Public License
-# along with this program; if not, write to the Free Software
-# Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307  USA
-#
-#===============================================================================
-
-/sbin/e-smith/expand-template /etc/mail/spamassassin/local.cf
-
-/usr/local/bin/svc -t /service/spamd
-
-exit 0
diff -Nur -x '*.orig' -x '*.rej' smeserver-spamassassin-1.3.0/root/var/service/spamd/run mezzanine_patched_smeserver-spamassassin-1.3.0/root/var/service/spamd/run
--- smeserver-spamassassin-1.3.0/root/var/service/spamd/run	2005-11-04 02:46:46.418708203 +1100
+++ mezzanine_patched_smeserver-spamassassin-1.3.0/root/var/service/spamd/run	2005-11-04 02:45:42.752923705 +1100
@@ -24,5 +24,7 @@
 SPAMD_STATUS=$(/sbin/e-smith/db configuration getprop spamassassin status)
 
 if [ "$SPAMD_STATUS" == "enabled" ]; then
-  exec /usr/bin/spamd -u spamd --syslog=stderr
+    exec /usr/bin/spamd -u spamd --syslog=stderr
+else
+    /usr/bin/runsvctrl down .
 fi
